version: "3.9"
services: 
  api:
    build: {context: ".",dockerfile: "Dockerfile.api"}
    ports: ["8000:8000"]
    env_file: [".env"]
    #depends_on: ["db","ml"]
  agents:
    build: {context: ".",dockerfile: "Dockerfile.agents"}
    env_file: [".env"]
    depends_on: ["api"]
  ml:
    build: {context: ".",dockerfile: "Dockerfile.ml"}
    env_file: [".env"]

  db:
    image: "postgres:15"
    restart: "always"
    env_file: [".env"]
    volumes: ["postgres_data:/var/lib/postgresql/data"]
volumes:
  postgres_data: {}
